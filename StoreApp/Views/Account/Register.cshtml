@model RegisterDto
<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/register.css" asp-append-version="true" />

<div class="register-container">
    <div class="register-card">
        <h2 class="register-title">Kayıt Ol</h2>
        
        <!-- Validation Summary - Sadece hata varsa göster -->
        @if (!ViewData.ModelState.IsValid && ViewData.ModelState.ErrorCount > 0)
        {
            <div class="validation-summary text-danger" asp-validation-summary="All"></div>
        }

        <form method="post" asp-action="Register">
            <!-- Kullanıcı Adı -->
            <div class="form-group">
                <label asp-for="UserName" class="form-label">
                    <i class="fa-solid fa-user"></i> Kullanıcı Adı
                </label>
                <input asp-for="UserName" class="form-input" placeholder="Kullanıcı adınızı girin" />
                <span class="text-danger" asp-validation-for="UserName"></span>
            </div>

            <!-- E-posta -->
            <div class="form-group">
                <label asp-for="Email" class="form-label">
                    <i class="fa-regular fa-envelope"></i> E-posta
                </label>
                <input asp-for="Email" class="form-input" type="email" placeholder="E-posta adresinizi girin" />
                <span class="text-danger" asp-validation-for="Email"></span>
            </div>

            <!-- Şifre -->
            <div class="form-group">
                <label asp-for="Password" class="form-label">
                    <i class="fa-solid fa-lock"></i> Şifre
                </label>
                <div class="password-wrapper">
                    <input type="password" asp-for="Password" class="form-input pwd-input" id="passwordInput"
                        pattern="^(?=.*[a-zçğıöşü])(?=.*[A-ZÇĞİÖŞÜ])(?=.*[!@@#$%^&*().,_+\-?=]).{8,}$"
                        placeholder="Şifrenizi girin"
                        title="En az 8 karakter, 1 büyük, 1 küçük ve 1 özel karakter içermelidir." />
                    <span id="togglePwdRegister" class="password-toggle" role="button" tabindex="0" aria-pressed="false">
                        <i class="fa-regular fa-eye"></i>
                    </span>
                </div>
                <span class="text-danger" asp-validation-for="Password"></span>
            </div>

            <!-- Şifre Kuralları -->
            <div class="password-rules">
                <h6 class="rules-title">Şifre Kuralları</h6>
                <ul id="passwordRules" class="rules-list">
                    <li data-rule="min">
                        <i class="rule-icon fa-solid fa-circle"></i>
                        <span>En az 8 karakter</span>
                    </li>
                    <li data-rule="upper">
                        <i class="rule-icon fa-solid fa-circle"></i>
                        <span>En az 1 BÜYÜK harf (A-Z, Ç, Ğ, İ, Ö, Ş, Ü)</span>
                    </li>
                    <li data-rule="lower">
                        <i class="rule-icon fa-solid fa-circle"></i>
                        <span>En az 1 küçük harf (a-z, ç, ğ, ı, ö, ş, ü)</span>
                    </li>
                    <li data-rule="special">
                        <i class="rule-icon fa-solid fa-circle"></i>
                        <span>En az 1 özel karakter (! @@ # $ % ^ & * ( ) . , _ + - ? =)</span>
                    </li>
                </ul>
            </div>

            <!-- Kayıt Ol Butonu -->
            <button type="submit" class="btn-register">
                Kayıt Ol
            </button>
        </form>

        <!-- Giriş Yap Linki -->
        <div class="login-link">
            Zaten hesabın var mı? <a asp-action="Login">Giriş Yap</a>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Şifre Göster/Gizle ---
            const input = document.getElementById('passwordInput');
            const toggleBtn = document.getElementById('togglePwdRegister');

            function togglePassword() {
                const isPassword = input.type === 'password';
                input.type = isPassword ? 'text' : 'password';

                const icon = toggleBtn.querySelector('i');
                if (icon) {
                    icon.className = isPassword ? 'fa-regular fa-eye-slash' : 'fa-regular fa-eye';
                }

                toggleBtn.setAttribute('aria-pressed', String(isPassword));
            }

            toggleBtn?.addEventListener('click', togglePassword);
            toggleBtn?.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    togglePassword();
                }
            });

            // --- Şifre Kuralları Validasyonu ---
            const rules = document.getElementById('passwordRules');
            const items = rules ? {
                min: rules.querySelector('[data-rule="min"]'),
                upper: rules.querySelector('[data-rule="upper"]'),
                lower: rules.querySelector('[data-rule="lower"]'),
                special: rules.querySelector('[data-rule="special"]'),
            } : {};

            const SPECIALS = "!@@#$%^&*().,_+-?=";

            function isLetterTR(c) {
                return c.toLocaleUpperCase('tr-TR') !== c.toLocaleLowerCase('tr-TR');
            }

            function hasUpper(s) {
                return [...s].some(c => isLetterTR(c) && c === c.toLocaleUpperCase('tr-TR') && c !== c.toLocaleLowerCase('tr-TR'));
            }

            function hasLower(s) {
                return [...s].some(c => isLetterTR(c) && c === c.toLocaleLowerCase('tr-TR') && c !== c.toLocaleUpperCase('tr-TR'));
            }

            function hasSpecial(s) {
                return [...s].some(c => SPECIALS.includes(c));
            }

            function setState(li, ok) {
                if (!li) return;
                li.classList.toggle('ok', ok);
                li.classList.toggle('bad', !ok);
            }

            function validate() {
                const v = input.value || '';
                setState(items.min, v.length >= 8);
                setState(items.upper, hasUpper(v));
                setState(items.lower, hasLower(v));
                setState(items.special, hasSpecial(v));
            }

            input?.addEventListener('input', validate);
            validate();
        });
    </script>
}