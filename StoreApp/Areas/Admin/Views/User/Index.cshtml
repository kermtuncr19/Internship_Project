@model IEnumerable<IdentityUser>

@{
    var roleMap = ViewBag.UserRoles as IDictionary<string, IList<string>>;
}


<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

<div class="text-center my-5">
    <div class="display-6 border-bottom pb-2">Kullanıcılar</div>
</div>

<div class="d-flex justify-content-end page-actions">
    <a asp-action="Create" class="btn btn-navy btn-pill">
        <i class="fa fa-solid fa-plus"></i>
        Kullanıcı Ekle
    </a>
</div>

<!-- ✅ DESKTOP/TABLET: mevcut tablo aynen kalsın -->
<div class="admin-table-wrap d-none d-md-block">
    <div class="table-responsive">
        <table class="table table-hover table-striped table-borderless align-middle table-admin">
            <thead>
                <tr>
                    <th class="table-col-id">Id</th>
                    <th>Kullanıcı Adı</th>
                    <th>Roller</th>
                    <th class="table-col-ops text-end">İşlemler</th>
                </tr>
            </thead>
            <tbody>
                @foreach (IdentityUser user in Model)
                {
                    <tr>
                        <td class="table-col-id">
                            <span class="truncate">@user.Id</span>
                        </td>
                        <td>@user.UserName</td>

                        <!-- Roller (mevcut component/JS dolduruyor) -->
                        <td>
                            @{
                                var roles = (roleMap != null && user.UserName != null && roleMap.ContainsKey(user.UserName))
                                ? roleMap[user.UserName]
                                : new List<string>();
                            }

                            @if (roles.Any())
                            {
                                foreach (var r in roles)
                                {
                                    <span class="badge bg-primary me-1">@r</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">—</span>
                            }
                        </td>


                        <td class="text-end table-col-ops">
                            <div class="actions d-inline-flex flex-nowrap gap-2">
                                <a class="btn btn-outline-navy btn-pill btn-sm" asp-action="Update"
                                    asp-route-id="@user.UserName">
                                    <i class="fa fa-solid fa-pen"></i>
                                    Düzenle
                                </a>

                                <a class="btn btn-outline-navy btn-pill btn-sm" asp-action="ResetPassword"
                                    asp-route-id="@user.UserName">
                                    <i class="fa fa-solid fa-key"></i>
                                    Şifreyi Sıfırla
                                </a>

                                <form method="post" asp-action="DeleteOneUser" class="m-0">
                                    <input type="hidden" name="UserName" value="@user.UserName" />
                                    <button type="submit" class="btn btn-danger btn-pill btn-sm">
                                        <i class="fa fa-solid fa-trash"></i>
                                        Sil
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- ✅ MOBİL: Kart liste -->
<div class="d-md-none admin-user-list mt-3">
    @foreach (IdentityUser user in Model)
    {
        <div class="admin-user-card">
            <div class="d-flex justify-content-between align-items-start gap-2">
                <div class="flex-grow-1">
                    <div class="fw-bold text-navy">@user.UserName</div>
                    <div class="small text-muted mt-1">
                        <span class="fw-semibold">Id:</span>
                        <span class="mono">@user.Id</span>
                    </div>

                    <div class="mt-2">
                        <span class="small text-muted fw-semibold">Roller:</span>

                        @{
                            var roles = (roleMap != null && user.UserName != null && roleMap.ContainsKey(user.UserName))
                            ? roleMap[user.UserName]
                            : new List<string>();
                        }

                        @if (roles.Any())
                        {
                            foreach (var r in roles)
                            {
                                <span class="badge bg-primary ms-1">@r</span>
                            }
                        }
                        else
                        {
                            <span class="ms-1 text-muted">—</span>
                        }
                    </div>


                </div>
            </div>

            <div class="admin-user-actions mt-3">
                <a class="btn btn-outline-navy btn-pill btn-sm" asp-action="Update" asp-route-id="@user.UserName">
                    <i class="fa fa-solid fa-pen me-1"></i> Düzenle
                </a>

                <a class="btn btn-outline-navy btn-pill btn-sm" asp-action="ResetPassword" asp-route-id="@user.UserName">
                    <i class="fa fa-solid fa-key me-1"></i> Şifre
                </a>

                <form method="post" asp-action="DeleteOneUser" class="m-0">
                    <input type="hidden" name="UserName" value="@user.UserName" />
                    <button type="submit" class="btn btn-danger btn-pill btn-sm w-100">
                        <i class="fa fa-solid fa-trash me-1"></i> Sil
                    </button>
                </form>
            </div>
        </div>
    }
</div>

<style>
    .text-navy {
        color: #0b2a6f !important;
    }

    .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .admin-user-list {
        display: grid;
        gap: 14px;
    }

    .admin-user-card {
        background: rgba(255, 255, 255, .95);
        border: 1px solid rgba(0, 0, 0, .06);
        border-radius: 18px;
        padding: 14px;
        box-shadow: 0 14px 40px rgba(0, 0, 0, .10);
    }

    /* Mobil butonlar: 2 + 1 düzen */
    .admin-user-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .admin-user-actions form {
        grid-column: 1 / -1;
    }

    /* Sil butonu full */
</style>